<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$50,000 Holiday Support Giveaway</title>
    <!-- å¼•å…¥ Roboto å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* å…¨å±€é‡ç½® */
        * { box-sizing: border-box; }
        body { 
            margin: 0; padding: 0; 
            font-family: 'Roboto', sans-serif; 
            background-color: #fdfbf7; /* ä¿æŒèƒŒæ™¯è‰²ä¸åŸæ¥ä¸€è‡´ */
            color: #333;
        }

        /* --- é¡¶éƒ¨ Header åŒºåŸŸ (ä¿æŒåŸæ ·) --- */
        .header { 
            background: linear-gradient(180deg, #fffaf0 0%, #f3e6c8 100%); 
            padding: 60px 20px 80px; 
            border-bottom: 1px solid #d4af37; 
            text-align: center;
        }
        h1 { font-family: 'Playfair Display', serif; font-size: 2.8em; margin: 0 0 15px; color: #2c2c2c; }
        .subtitle { font-size: 1.1em; color: #555; max-width: 700px; margin: 0 auto 30px; }
        .money-hero { width: 100%; max-width: 450px; display: block; margin: 0 auto; }
        
        /* é‡‘è‰²æ¨ªå¹… */
        .gold-banner { 
            background: linear-gradient(90deg, #bf953f, #fcf6ba, #bf953f); 
            color: #5c4308; padding: 12px; font-weight: bold; 
            max-width: 800px; margin: -25px auto 40px; 
            border-radius: 5px; text-align: center; position: relative; z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* --- ä¸­é—´äº’åŠ¨åŒº --- */
        .timer-section { text-align: center; margin: 50px 0; }
        .timer { font-size: 3.5em; color: #d63031; font-weight: 700; }
        
        .grid-container { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; 
            max-width: 380px; margin: 0 auto 60px; 
        }
        .mystery-box { 
            background: #fff; border-radius: 15px; padding: 20px; 
            cursor: pointer; border: 1px solid #eee; transition: transform 0.2s;
        }
        .mystery-box:hover { transform: translateY(-5px); }
        .mystery-box img { width: 100%; }

        .stats-container { display: flex; justify-content: center; gap: 60px; margin-bottom: 80px; text-align: center;}
        .stat-item h2 { color: #d63031; font-size: 2.2em; margin: 0; font-family: 'Playfair Display', serif; }
        
        /* --- æ ¸å¿ƒä¿®æ”¹ï¼šè¯„è®ºåŒº (å®Œå…¨åŸºäºæ‚¨æä¾›çš„ MasterGo ä»£ç ) --- */
        .reviews-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center; /* è®©è¯„è®ºå±…ä¸­ */
            padding-bottom: 80px;
        }

        .section-title { text-align: center; font-family: 'Playfair Display', serif; font-size: 1.5em; margin-bottom: 40px; }

        /* å•ä¸ªè¯„è®ºå¡ç‰‡å®¹å™¨ - å¯¹åº” w-[500px] flex-col gap-3 */
        .review-card {
            width: 500px; /* å›ºå®šå®½åº¦ 500px */
            max-width: 90vw; /* æ‰‹æœºä¸Šè‡ªé€‚åº” */
            display: flex;
            flex-direction: column;
            gap: 12px; /* gap-3 */
            margin-bottom: 40px; /*ä»¥æ­¤æ‹‰å¼€æ¯ä¸ªè¯„è®ºçš„é—´è·*/
            align-items: flex-start;
            text-align: left;
        }

        /* ç”¨æˆ·å¤´éƒ¨ - å¯¹åº” w-[177px] h-[36px] */
        .user-header {
            height: 36px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        /* å¤´åƒ - å¯¹åº” Ellipse 7 */
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* åå­— - å¯¹åº” text-[#111111] font-semibold */
        .user-name {
            color: #111111;
            font-size: 14px; /* text-sm */
            font-weight: 600; /* font-semibold */
            font-family: 'Roboto', sans-serif;
            line-height: 24px;
        }

        /* è¯„è®ºå†…å®¹åŒº - å¯¹åº” flex-col gap-2.5 */
        .content-body {
            display: flex;
            flex-direction: column;
            gap: 10px; /* gap-2.5 */
            width: 100%;
        }

        /* æ–‡å­— - å¯¹åº” text-[#333333] leading-5 */
        .review-text {
            color: #333333;
            font-family: 'Roboto', sans-serif;
            font-size: 16px; 
            line-height: 20px; /* leading-5 */
            margin: 0;
        }

        /* åº•éƒ¨ Meta ä¿¡æ¯ - å¯¹åº” flex-row gap-3 */
        .review-meta {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px; /* gap-3 */
            margin-top: 5px;
        }

        /* çº¢è‰² Like Reply - å¯¹åº” text-[#E11B22] */
        .meta-action {
            color: #E11B22;
            font-size: 12px; /* text-xs */
            font-weight: 400;
            line-height: 14px;
            cursor: pointer;
        }

        /* ç°è‰²æ—¶é—´ - å¯¹åº” text-[#666666] */
        .meta-time {
            color: #666666;
            font-size: 12px; /* text-xs */
            font-weight: 400;
            line-height: 14px;
        }

        /* å¼¹çª— */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 320px; }
        .btn { background: #d4af37; color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; margin-top: 20px; }

    </style>
</head>
<body>

    <div class="header">
        <h1>$50,000 Holiday Support Giveaway</h1>
        <p class="subtitle">A chance to receive financial assistance for individuals and families facing financial difficulties</p>
        <img src="header-money.png" alt="Cash" class="money-hero" onerror="this.style.display='none'">
    </div>

    <div class="gold-banner">
        Participation gives you a chance to receive financial support
    </div>

    <div class="timer-section">
        <div style="margin-bottom:10px;">Choose a mystery box to participate in the giveaway</div>
        <div class="timer" id="timer">05:00</div>
    </div>

    <div class="grid-container" id="box-grid"></div>

    <div class="stats-container">
        <div class="stat-item">
            <h2 id="participant-count">...</h2>
            <p>Total number of participants</p>
        </div>
        <div class="stat-item">
            <h2 id="satisfaction-rate">...</h2>
            <p>Prize winning satisfaction</p>
        </div>
    </div>

    <!-- è¯„è®ºåŒºåŸŸ -->
    <div class="reviews-section">
        <h3 class="section-title">User Reviews</h3>
        <p style="text-align:center; color:#999; margin-bottom:30px;">See what our users are saying</p>
        
        <div id="reviews-list">
            <!-- JS å°†åœ¨è¿™é‡Œæ’å…¥ HTML -->
            Loading reviews...
        </div>
    </div>

    <!-- å¼¹çª— -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2 id="modalTitle">Loading...</h2>
            <p id="modalMessage"></p>
            <button class="btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        // ==========================================
        // è¯·ç¡®ä¿è¿™é‡Œæ˜¯æ‚¨çš„ Render åœ°å€
        // ==========================================
        const API_BASE_URL = "https://giveaway-backend-w2qa.onrender.com"; 

        // å€’è®¡æ—¶
        let timeLeft = 300;
        setInterval(() => {
            if(timeLeft <= 0) return;
            timeLeft--;
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timer').innerText = `0${m}:${s < 10 ? '0'+s : s}`;
        }, 1000);

        // è·å–æ•°æ®å¹¶æ¸²æŸ“
        async function fetchData() {
            try {
                // 1. è·å–ç»Ÿè®¡
                const statRes = await fetch(`${API_BASE_URL}/stats`);
                const statData = await statRes.json();
                document.getElementById('participant-count').innerText = statData.participants.toLocaleString();
                document.getElementById('satisfaction-rate').innerText = statData.satisfaction + '%';

                // 2. è·å–è¯„è®º
                const revRes = await fetch(`${API_BASE_URL}/reviews`);
                const reviews = await revRes.json();
                const container = document.getElementById('reviews-list');
                
                // --- æ¸²æŸ“å¾ªç¯ ---
                container.innerHTML = reviews.map((r, index) => {
                    // å›¾ç‰‡å°ºå¯¸é€»è¾‘
                    // é»˜è®¤: 200x200
                    let imgStyle = "width: 200px; height: 200px;";
                    
                    // ç¬¬ä¸€å¼  (Thanh): 200x270
                    if (index === 0) {
                        imgStyle = "width: 200px; height: 270px;";
                    }
                    
                    // æ·»åŠ  object-fit é˜²æ­¢å˜å½¢ï¼Œåœ†è§’
                    imgStyle += " object-fit: cover; border-radius: 0px; display: block;";

                    // ç”Ÿæˆ HTML (å®Œå…¨å¯¹åº” MasterGo ç»“æ„)
                    return `
                    <div class="review-card">
                        <!-- å¤´éƒ¨: å¤´åƒ + åå­— -->
                        <div class="user-header">
                            <div class="user-avatar" style="background:${r.avatar_color}">
                                ${r.user_name[0]}
                            </div>
                            <span class="user-name">${r.user_name}</span>
                        </div>

                        <!-- å†…å®¹: æ–‡å­— + å›¾ç‰‡ + Meta -->
                        <div class="content-body">
                            <p class="review-text">
                                ${r.content}
                            </p>
                            
                            <!-- å›¾ç‰‡ (å¦‚æœåå°æœ‰å›¾ç‰‡åˆ™æ˜¾ç¤º) -->
                            ${r.image ? `<img src="${r.image}" style="${imgStyle}" onerror="this.style.display='none'">` : ''}
                            
                            <!-- åº•éƒ¨ä¿¡æ¯ -->
                            <div class="review-meta">
                                <span class="meta-action">Like Â· Reply Â·</span>
                                <span class="meta-time">${r.time_ago}</span>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
                
            } catch (e) {
                console.error("Error:", e);
                document.getElementById('reviews-list').innerText = "Loading failed.";
            }
        }

        // ç”Ÿæˆç›’å­
        const grid = document.getElementById('box-grid');
        for(let i=0; i<6; i++) {
            const box = document.createElement('div');
            box.className = 'mystery-box';
            box.innerHTML = `<img src="box.png" onerror="this.style.display='none'; this.parentNode.innerText='ğŸ'" style="width:100%">`;
            box.onclick = () => play(i);
            grid.appendChild(box);
        }

        // æŠ½å¥–
        async function play(boxId) {
            const modal = document.getElementById('resultModal');
            document.getElementById('modalTitle').innerText = "Opening...";
            document.getElementById('modalMessage').innerText = "Checking...";
            modal.style.display = 'flex';
            
            try {
                const res = await fetch(`${API_BASE_URL}/play`, { method: 'POST' });
                const data = await res.json();
                document.getElementById('modalTitle').innerText = data.is_winner ? "ğŸ‰ Winner!" : "Not Selected";
                document.getElementById('modalMessage').innerText = data.message;
            } catch (e) {
                document.getElementById('modalMessage').innerText = "Network Error";
            }
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        fetchData();
    </script>
</body>
</html>
